
 config/cf/xorg.cf                                        |    2 +-
 programs/Xserver/fb/fbmmx.c                              |   13 +++++++------
 programs/Xserver/hw/xfree86/drivers/ati/radeon_chipset.h |    2 +-
 3 files changed, 9 insertions(+), 8 deletions(-)

--- X11-6.8.2/xc/config/cf/xorg.cf.orig	2005-03-21 19:11:42.000000000 +0100
+++ X11-6.8.2/xc/config/cf/xorg.cf	2005-03-21 23:03:46.000000000 +0100
@@ -1541,7 +1541,7 @@
 #  if defined(UseInstalled)
 #   define DefaultCCOptions /* -ansi */
 #  else
-#   define DefaultCCOptions -ansi -pedantic GccWarningOptions
+#   define DefaultCCOptions -std=gnu9x -pedantic GccWarningOptions
 #  endif
 # endif
 # if defined(UseInstalled)
--- X11-6.8.2/xc/programs/Xserver/fb/fbmmx.c.orig	2004-07-22 21:24:50.000000000 +0200
+++ X11-6.8.2/xc/programs/Xserver/fb/fbmmx.c	2005-02-15 10:32:50.573357352 +0100
@@ -27,6 +27,8 @@
 
 #ifdef USE_GCC34_MMX
 
+#include <mmintrin.h>
+
 #ifdef RENDER
 
 #include "picturestr.h"
@@ -33,10 +34,10 @@
 #include "mipict.h"
 #include "fbpict.h"
 
-typedef int Vector1x64 __attribute__ ((mode(DI)));
-typedef int Vector2x32 __attribute__ ((mode(V2SI)));
-typedef int Vector4x16 __attribute__ ((mode(V4HI)));
-typedef int Vector8x8  __attribute__ ((mode(V8QI)));
+typedef __m64 Vector1x64;
+typedef __v2si Vector2x32;
+typedef __v4hi Vector4x16;
+typedef __v8qi Vector8x8;
 
 typedef unsigned long long ullong;
 
@@ -92,9 +93,9 @@
 shift (Vector1x64 v, int s)
 {
     if (s > 0)
-	return __builtin_ia32_psllq (v, s);
+	return (Vector1x64)__builtin_ia32_psllq ((ullong)v, (ullong)s);
     else if (s < 0)
-	return __builtin_ia32_psrlq (v, -s);
+	return (Vector1x64)__builtin_ia32_psrlq ((ullong)v, (ullong)-s);
     else
 	return v;
 }
